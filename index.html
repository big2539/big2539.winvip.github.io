<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>แชร์ Flex — LIFF ShareTargetPicker</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap');

    :root{
      --bg1: #0f1724;
      --bg2: #0b1220;
      --accent: linear-gradient(135deg,#7b61ff 0%, #00d4ff 100%);
      --glass: rgba(255,255,255,0.04);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:'Prompt',sans-serif;
      background: radial-gradient(1200px 600px at 10% 20%, rgba(123,97,255,0.12), transparent 10%),
                  radial-gradient(1000px 500px at 90% 80%, rgba(0,212,255,0.06), transparent 10%),
                  linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#e6eef8;
      padding:24px;
    }

    .card{
      width:100%;
      max-width:760px;
      border-radius:18px;
      padding:28px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), 0 0 40px rgba(123,97,255,0.06) inset;
      backdrop-filter: blur(8px);
      display:grid;
      gap:20px;
      grid-template-columns: 1fr 320px;
      align-items:center;
    }

    .left{
      padding:10px 18px;
    }

    h1{
      margin:0 0 8px 0;
      font-size:20px;
      font-weight:700;
      letter-spacing:0.2px;
    }
    p.lead{
      margin:0 0 14px 0;
      color: #cfe9ff;
      opacity:0.9;
      font-size:14px;
    }

    /* preview */
    .preview{
      border-radius:12px;
      overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 6px 18px rgba(2,6,23,0.5);
      border: 1px solid rgba(255,255,255,0.03);
    }
    .preview .hero{
      width:100%;
      height:160px;
      background-position:center;
      background-size:cover;
      display:flex;
      align-items:flex-end;
      padding:12px;
      gap:8px;
      color:white;
      background-blend-mode:overlay;
      box-shadow: inset 0 -40px 80px rgba(0,0,0,0.5);
    }
    .preview .body{
      padding:12px;
      font-size:13px;
      color:#dcecff;
    }
    .preview .cta{
      display:flex;
      gap:8px;
      padding:12px;
      border-top:1px solid rgba(255,255,255,0.02);
      justify-content:flex-end;
      background: linear-gradient(180deg, rgba(255,255,255,0.006), transparent);
    }
    .cta a{
      text-decoration:none;
      font-weight:600;
      font-size:13px;
      padding:8px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.03);
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    }

    /* center big button column */
    .right{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      flex-direction:column;
      padding:6px;
    }

    .share-btn{
      --g: linear-gradient(90deg,#7b61ff,#00d4ff);
      padding:14px 22px;
      border-radius:14px;
      font-weight:700;
      font-size:16px;
      background:var(--g);
      box-shadow: 0 8px 30px rgba(123,97,255,0.18), 0 2px 8px rgba(0,0,0,0.4);
      border:none;
      color:white;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .share-btn:active{ transform:translateY(1px) scale(.998) }
    .share-btn[disabled]{
      opacity:0.6;
      cursor:not-allowed;
      box-shadow:none;
    }

    .note{
      font-size:12px;
      color:#bcdcff;
      text-align:center;
      opacity:0.9;
    }

    @media (max-width:800px){
      .card{ grid-template-columns: 1fr; padding:18px; gap:14px; }
      .right{ flex-direction:row; }
    }
  </style>
</head>
<body>

  <div class="card" role="main" aria-label="แชร์ Flex ไปยังเพื่อนหรือกลุ่ม">
    <div class="left">
      <h1>แชร์เพื่อรับสิทธิ์ — ตัวอย่าง Flex</h1>
      <p class="lead">กดปุ่มด้านขวาเพื่อเปิดหน้าต่างเลือกเพื่อนหรือกลุ่มในแอป LINE แล้วส่ง Flex message ตัวอย่าง (มีรูป + ปุ่มไปยัง winnerst88.carrd.co)</p>

      <div class="preview" aria-hidden="true">
        <div class="hero" id="previewHero" style="background-image: url('https://img5.pic.in.th/file/secure-sv1/image---2025-12-07T221431.435.png')">
          <!-- optional small label -->
        </div>
        <div class="body">
          <strong>รับสิทธิพิเศษทันที!</strong>
          <div style="margin-top:8px; color:#e0f2ff; opacity:0.95;">
            แชร์โพสต์นี้ให้เพื่อนหรือกลุ่ม แล้วรับสิทธิพิเศษตามเงื่อนไข
          </div>
        </div>
        <div class="cta">
          <a href="https://winnerst88.carrd.co" target="_blank" rel="noopener">ไปที่ winnerst88.carrd.co</a>
        </div>
      </div>
    </div>

    <div class="right">
      <button id="btnShare" class="share-btn">กดแชร์ให้เพื่อน/กลุ่ม</button>
      <div class="note" id="statusNote">ทดสอบจากแอป LINE เพื่อใช้งานเต็มรูปแบบ</div>
    </div>
  </div>

  <script>
    // ใส่ LIFF ID ของคุณที่นี่
    const LIFF_ID = "2008637844-5AezaL79";

    const btnShare = document.getElementById('btnShare');
    const statusNote = document.getElementById('statusNote');

    // ตัวอย่าง Flex message ที่จะส่ง
    const flexMessage = {
      type: "flex",
      altText: "รับสิทธิ์! แชร์แล้วรับของรางวัล",
      contents: {
        type: "bubble",
        hero: {
          type: "image",
          url: "https://img5.pic.in.th/file/secure-sv1/image---2025-12-07T221431.435.png",
          size: "full",
          aspectRatio: "16:9",
          aspectMode: "cover"
        },
        body: {
          type: "box",
          layout: "vertical",
          spacing: "sm",
          contents: [
            {
              type: "text",
              text: "รับสิทธิพิเศษทันที!",
              weight: "bold",
              size: "md"
            },
            {
              type: "text",
              text: "แชร์โพสต์นี้ให้เพื่อนหรือกลุ่ม เพื่อรับสิทธิ์ตามเงื่อนไข",
              wrap: true,
              margin: "sm",
              size: "sm",
              color: "#666666"
            }
          ]
        },
        footer: {
          type: "box",
          layout: "vertical",
          contents: [
            {
              type: "button",
              style: "primary",
              action: {
                type: "uri",
                label: "ไปที่ winnerst88.carrd.co",
                uri: "https://winnerst88.carrd.co"
              }
            }
          ]
        }
      }
    };

    // init LIFF
    async function initLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        const inClient = liff.isInClient(); // true when opened in LINE
        if (!inClient) {
          statusNote.textContent = "โปรดเปิดหน้านี้จากแอป LINE (LIFF client) เพื่อแชร์โดยตรง";
          // still allow testing but shareTargetPicker will fail outside client
        } else {
          statusNote.textContent = "พร้อมแชร์ — เปิดจากแอป LINE เรียบร้อย";
        }
      } catch (err) {
        console.error("LIFF init error:", err);
        statusNote.textContent = "เกิดข้อผิดพลาดในการเชื่อมต่อ LIFF (ตรวจสอบ LIFF ID และ URL)";
        btnShare.disabled = true;
      }
    }

    // shareTargetPicker handler
    async function handleShare() {
      try {
        // ตรวจสอบว่า API มีให้ใช้
        if (!liff || !liff.shareTargetPicker) {
          alert("ไม่พบฟังก์ชัน shareTargetPicker ใน LIFF SDK นี้");
          return;
        }

        // เรียก shareTargetPicker ส่งเป็น array ของ message objects
        const messages = [flexMessage];

        // Optionally: you can pass a callback param to handle result
        await liff.shareTargetPicker(messages)
          .then((res) => {
            // If resolved without error, it means user completed selection or closed the picker.
            // Note: some LIFF versions resolve even if user cancels — behavior can vary.
            console.log("shareTargetPicker result:", res);
            alert("เรียบร้อย! ผู้ใช้ถูกเรียกให้เลือกผู้รับแล้ว (ตรวจสอบในแอป LINE)");
          })
          .catch((err) => {
            console.error("shareTargetPicker error:", err);
            alert("เกิดข้อผิดพลาดขณะแชร์: " + (err.message || err));
          });

      } catch (error) {
        console.error("handleShare error:", error);
        alert("เกิดข้อผิดพลาด: " + (error.message || error));
      }
    }

    // attach
    btnShare.addEventListener('click', async () => {
      btnShare.disabled = true;
      btnShare.textContent = 'กำลังเปิดตัวเลือก...';
      try {
        await handleShare();
      } finally {
        btnShare.disabled = false;
        btnShare.textContent = 'กดแชร์ให้เพื่อน/กลุ่ม';
      }
    });

    // initialize on load
    window.addEventListener('load', initLiff);
  </script>
</body>
</html>
